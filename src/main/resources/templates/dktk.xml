<template id="dktk" excel-filename="generated-test-${TIMESTAMP}.xlsx">

  <container csv-filename="Patient-${TIMESTAMP}.csv" excel-sheet="Patient">
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Patient.id.value"/>
    <attribute csv-column="DKTK-ID-Global" excel-column="DKTK-ID-Global" fhir-path="Patient.identifier.where(type.coding.code = 'Global').value.value"/>
    <attribute csv-column="DKTK-ID-Lokal" excel-column="DKTK-ID-Lokal" fhir-path="Patient.identifier.where(type.coding.code = 'Lokal').value.value" />
    <attribute csv-column="Geburtsdatum" excel-column="Geburtsdatum" fhir-path="Patient.birthDate.value"/>
    <attribute csv-column="Geschlecht" excel-column="Geschlecht" fhir-path="Patient.gender.value" />
    <attribute csv-column="Datum des letztbekannten Vitalstatus" excel-column="Datum des letztbekannten Vitalstatus" fhir-path="Observation.where(code.coding.code = '75186-7').effective.value" parent-fhir-path="Observation.where(code.coding.code = '75186-7').subject.reference.value"/>
    <attribute csv-column="Untersuchungs-, Befunddatum im Verlauf" excel-column="Untersuchungs-, Befunddatum im Verlauf" fhir-path="ClinicalImpression.effective.value" parent-fhir-path="ClinicalImpression.subject.reference.value"/>
    <attribute csv-column="Tumor Diagnosedatum" excel-column="Tumor Diagnosedatum" fhir-path="Condition.onset.value" parent-fhir-path="Condition.subject.reference.value"/>
    <attribute csv-column="Vitalstatus" excel-column="Vitalstatus" fhir-path="Observation.where(code.coding.code = '75186-7').value.coding.code.value" parent-fhir-path="Observation.where(code.coding.code = '75186-7').subject.reference.value"/>
    <attribute csv-column="Tod tumorbedingt" excel-column="Tod tumorbedingt" fhir-path="Observation.where(code.coding.code = '68343-3').value.coding.where(system = 'http://fhir.de/CodeSystem/bfarm/icd-10-gm').code.value" parent-fhir-path="Observation.where(code.coding.code = '68343-3').subject.reference.value"/>
    <attribute csv-column="Todesursachen" excel-column="Todesursachen" fhir-path="Observation.where(code.coding.code = '68343-3').value.coding.where(system = 'http://dktk.dkfz.de/fhir/onco/core/CodeSystem/JNUCS').code.value" parent-fhir-path="Observation.where(code.coding.code = '68343-3').subject.reference.value"/>
  </container>

  <container csv-filename="Diagnosis-${TIMESTAMP}.csv" excel-sheet="Diagnosis">
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Condition.id.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Condition.subject.reference.value"/>
    <attribute csv-column="Primärdiagnose" excel-column="Primärdiagnose" fhir-path="Condition.code.coding.code.value"/>
    <attribute csv-column="Tumor Diagnosedatum" excel-column="Tumor Diagnosedatum" fhir-path="Condition.onset.value"/>
    <attribute csv-column="Primaertumor Diagnosetext" excel-column="Primaertumor Diagnosetext" fhir-path="Condition.code.text.value"/>
    <attribute csv-column="Version des ICD-10-Katalogs" excel-column="Version des ICD-10-Katalogs" fhir-path="Condition.code.coding.version.value"/>
    <attribute csv-column="Lokalisation" excel-column="Lokalisation" fhir-path="Condition.bodySite.coding.where(system = 'urn:oid:2.16.840.1.113883.6.43.1').code.value"/>
    <attribute csv-column="ICD-O Katalog Topographie (Version)" excel-column="ICD-O Katalog Topographie (Version)" fhir-path="Condition.bodySite.coding.where(system = 'urn:oid:2.16.840.1.113883.6.43.1').version.value"/>
    <attribute csv-column="Seitenlokalisation nach ADT-GEKID" excel-column="Seitenlokalisation nach ADT-GEKID" fhir-path="Condition.bodySite.coding.where(system = 'urn:oid:2.16.840.1.113883.2.6.60.7.1.1').code.value"/>
    <!-- TODO: Grading depends on Diagnosis, not on histology. Apart of that, an observation cannot depend on another observation.
    Therefore, it is currently not possible to establish a relationship between grading and diagnosis. -->
    <attribute csv-column="Grading" excel-column="Grading" fhir-path="Observation.where(code.coding.code = '59542-1').value.coding.code.value" parent-fhir-path="Observation.where(code.coding.code = '59542-1').focus.reference.value"/>
    <attribute csv-column="Lokale Beurteilung Resttumor" excel-column="Lokale Beurteilung Resttumor" fhir-path="Observation.where(code.coding.code = '84892-9').value.coding.code.value" parent-fhir-path="Observation.where(code.coding.code = '84892-9').focus.reference.value"/>
    <attribute csv-column="Gesamtbeurteilung Resttumor" excel-column="Gesamtbeurteilung Resttumor" fhir-path="Observation.where(code.coding.code = '81169-5').value.coding.code.value" parent-fhir-path="Observation.where(code.coding.code = '81169-5').focus.reference.value" />
  </container>

  <container csv-filename="Histology-${TIMESTAMP}.csv" excel-sheet="Histology" >
    <attribute csv-column="Histology-ID" excel-column="Histology-ID" fhir-path="Observation.where(code.coding.code = '59847-4').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Observation.where(code.coding.code = '59847-4').focus.reference.value" />
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Observation.where(code.coding.code = '59847-4').subject.reference.value" />
    <attribute csv-column="Histologie Datum" excel-column="Histologie Datum" fhir-path="Observation.where(code.coding.code = '59847-4').effective.value"/>
    <attribute csv-column="ICD-O Katalog Morphologie (Version)" excel-column="ICD-O Katalog Morphologie (Version)" fhir-path="Observation.where(code.coding.code = '59847-4').value.coding.version.value" />
    <attribute csv-column="Morphologie" excel-column="Morphologie" fhir-path="Observation.where(code.coding.code = '59847-4').value.coding.code.value"/>
    <attribute csv-column="Morphologie-Freitext" excel-column="Morphologie-Freitext" fhir-path="Observation.where(code.coding.code = '59847-4').value.text.value"/>
  </container>


  <container csv-filename="Metastasis-${TIMESTAMP}.csv" excel-sheet="Metastasis" >
    <attribute csv-column="Metastasis-ID" excel-column="Metastatsis-ID" fhir-path="Observation.where(code.coding.code = '21907-1').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Observation.where(code.coding.code = '21907-1').focus.reference.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Observation.where(code.coding.code = '21907-1').subject.reference.value" />
    <attribute csv-column="Datum diagnostischer Sicherung" excel-column="Datum diagnostischer Sicherung" fhir-path="Observation.where(code.coding.code = '21907-1').effective.value"/>
    <attribute csv-column="Fernmetastasen vorhanden" excel-column="Fernmetastasen vorhanden" fhir-path="Observation.where(code.coding.code = '21907-1').value.coding.code.value"/>
    <attribute csv-column="Lokalisation Fernmetastasen" excel-column="Lokalisation Fernmetastasen" fhir-path="Observation.where(code.coding.code = '21907-1').bodySite.coding.code.value"/>
  </container>

  <container csv-filename="TNMc-${TIMESTAMP}.csv" excel-sheet="TNMc">
    <attribute csv-column="TNMc-ID" excel-column="TNMc-ID" fhir-path="Observation.where(code.coding.code = '21908-9').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Observation.where(code.coding.code = '21908-9').focus.reference.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Observation.where(code.coding.code = '21908-9').subject.reference.value" />
    <attribute csv-column="Datum der TNM-Dokumentation/Datum Befund" excel-column="Datum der TNM-Dokumentation/Datum Befund" fhir-path="Observation.coding.where(code.coding.code = '21908-9').effective.value"/>
    <attribute csv-column="UICC Stadium" excel-column="UICC Stadium" fhir-path="Observation.coding.where(code.coding.code = '21908-9').value.coding.code.value"/>
    <attribute csv-column="TNM-T" excel-column="TNM-T" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '21905-5').value.coding.code.value"/>
    <attribute csv-column="TNM-N" excel-column="TNM-N" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '21906-3').value.coding.code.value"/>
    <attribute csv-column="TNM-M" excel-column="TNM-M" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '21907-1').value.coding.code.value"/>
    <attribute csv-column="c/p/u-Präfix T" excel-column="c/p/u-Präfix T" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '21905-5').extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-TNMcpuPraefix').value.coding.code.value"/>
    <attribute csv-column="c/p/u-Präfix N" excel-column="c/p/u-Präfix N" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '21906-3').extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-TNMcpuPraefix').value.coding.code.value"/>
    <attribute csv-column="c/p/u-Präfix M" excel-column="c/p/u-Präfix M" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '21907-1').extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-TNMcpuPraefix').value.coding.code.value"/>
    <attribute csv-column="TNM-y-Symbol" excel-column="TNM-y-Symbol" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '59479-6').value.coding.code.value"/>
    <attribute csv-column="TNM-r-Symbol" excel-column="TNM-r-Symbol" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '21983-2').value.coding.code.value"/>
    <attribute csv-column="TNM-m-Symbol" excel-column="TNM-m-Symbol" fhir-path="Observation.where(code.coding.code = '21908-9').component.where(code.coding.code = '42030-7').value.coding.code.value"/>
    <attribute csv-column="TNM-Version" excel-column="TNM-Version" fhir-path="Observation.coding.where(code.coding.code = '21908-9').value.coding.version.value"/>
  </container>


  <container csv-filename="TNMp-${TIMESTAMP}.csv" excel-sheet="TNMp">
    <attribute csv-column="TNMc-ID" excel-column="TNMc-ID" fhir-path="Observation.where(code.coding.code = '21902-2').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Observation.where(code.coding.code = '21902-2').focus.reference.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Observation.where(code.coding.code = '21902-2').subject.reference.value" />
    <attribute csv-column="Datum der TNM-Dokumentation/Datum Befund" excel-column="Datum der TNM-Dokumentation/Datum Befund" fhir-path="Observation.coding.where(code.coding.code = '21902-2').effective.value"/>
    <attribute csv-column="UICC Stadium" excel-column="UICC Stadium" fhir-path="Observation.coding.where(code.coding.code = '21902-2').value.coding.code.value"/>
    <attribute csv-column="TNM-T" excel-column="TNM-T" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '21899-0').value.coding.code.value"/>
    <attribute csv-column="TNM-N" excel-column="TNM-N" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '21900-6').value.coding.code.value"/>
    <attribute csv-column="TNM-M" excel-column="TNM-M" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '21901-4').value.coding.code.value"/>
    <attribute csv-column="c/p/u-Präfix T" excel-column="c/p/u-Präfix T" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '21899-0').extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-TNMcpuPraefix').value.coding.code.value"/>
    <attribute csv-column="c/p/u-Präfix N" excel-column="c/p/u-Präfix N" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '21900-6').extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-TNMcpuPraefix').value.coding.code.value"/>
    <attribute csv-column="c/p/u-Präfix M" excel-column="c/p/u-Präfix M" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '21901-4').extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-TNMcpuPraefix').value.coding.code.value"/>
    <attribute csv-column="TNM-y-Symbol" excel-column="TNM-y-Symbol" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '59479-6').value.coding.code.value"/>
    <attribute csv-column="TNM-r-Symbol" excel-column="TNM-r-Symbol" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '21983-2').value.coding.code.value"/>
    <attribute csv-column="TNM-m-Symbol" excel-column="TNM-m-Symbol" fhir-path="Observation.where(code.coding.code = '21902-2').component.where(code.coding.code = '42030-7').value.coding.code.value"/>
    <attribute csv-column="TNM-Version" excel-column="TNM-Version" fhir-path="Observation.coding.where(code.coding.code = '21902-2').value.coding.version.value"/>
  </container>


  <container csv-filename="Progress-${TIMESTAMP}.csv" excel-sheet="Progress">
    <attribute csv-column="Progess-ID" excel-column="Progress-ID" fhir-path="Observation.where(code.coding.code = '21976-6').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Observation.where(code.coding.code = '21976-6').focus.reference.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Observation.where(code.coding.code = '21976-6').subject.reference.value" />
    <attribute csv-column="Ansprechen im Verlauf" excel-column="Ansprechen im Verlauf" fhir-path="Observation.where(code.coding.code = '21976-6').value.coding.code.value"/>
    <attribute csv-column="Datum lokales oder regionäres Rezidiv" excel-column="Datum lokales oder regionäres Rezidiv" fhir-path="Observation.where(code.coding.code = 'LA4583-6').effective.value" parent-fhir-path="Observation.where(code.coding.code = '21976-6').focus.reference.value"/>
    <attribute csv-column="Lokales oder regionäres Rezidiv" excel-column="Lokales oder regionäres Rezidiv" fhir-path="Observation.where(code.coding.code = 'LA4583-6').value.coding.code.value" parent-fhir-path="Observation.where(code.coding.code = '21976-6').focus.reference.value"/>
    <attribute csv-column="Fernmetastasen" excel-column="Fernmetastasen" fhir-path="Observation.where(code.coding.code = 'LA4226-2').value.coding.code.value" parent-fhir-path="Observation.where(code.coding.code = '21976-6').focus.reference.value"/>
    <attribute csv-column="Lymphknoten-Rezidiv" excel-column="Lymphknoten-Rezidiv" fhir-path="Observation.where(code.coding.code = 'LA4370-8').value.coding.code.value" parent-fhir-path="Observation.where(code.coding.code = '21976-6').focus.reference.value"/>
  </container>


  <container csv-filename="System-Therapy-${TIMESTAMP}.csv" excel-sheet="System Therapy">
    <attribute csv-column="System-Therapy-ID" excel-column="System-Therapy-ID" fhir-path="MedicationStatement.id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="MedicationStatement.reasonReference.reference.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="MedicationStatement.subject.reference.value" />
    <attribute csv-column="Systemische Therapie Stellung zu operativer Therapie" excel-column="Systemische Therapie Stellung zu operativer Therapie" fhir-path="MedicationStatement.extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-StellungZurOp').value.coding.code.value"/>
    <attribute csv-column="Intention Chemotherapie" excel-column="Intention Chemotherapie" fhir-path="MedicationStatement.extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-SYSTIntention').value.coding.code.value"/>
    <attribute csv-column="Therapieart" excel-column="Therapieart" fhir-path="MedicationStatement.category.coding.code.value"/>
    <attribute csv-column="Systemische Therapie Beginn" excel-column="Systemische Therapie Beginn" fhir-path="MedicationStatement.effective.start.value"/>
    <attribute csv-column="Systemische Therapie Ende" excel-column="Systemische Therapie Ende" fhir-path="MedicationStatement.effective.end.value"/>
    <attribute csv-column="Systemische Therapie Protokoll" excel-column="Systemische Therapie Protokoll" fhir-path="MedicationStatement.extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-SystemischeTherapieProtokoll').value.text.value"/>
    <attribute csv-column="Systemische Therapie Substanzen" excel-column="Systemische Therapie Substanzen" fhir-path="MedicationStatement.medication.text.value"/>
    <attribute csv-column="Chemotherapie" excel-column="Chemotherapie" fhir-path="MedicationStatement.where(category.coding.code = 'CH').exists()"/>
    <attribute csv-column="Hormontherapie" excel-column="Hormontherapie" fhir-path="MedicationStatement.where(category.coding.code = 'HO').exists()"/>
    <attribute csv-column="Immuntherapie" excel-column="Immuntherapie" fhir-path="MedicationStatement.where(category.coding.code = 'IM').exists()"/>
    <attribute csv-column="Knochenmarktransplantation" excel-column="Knochenmarktransplantation" fhir-path="MedicationStatement.where(category.coding.code = 'KM').exists()"/>
    <attribute csv-column="Abwartende Strategie" excel-column="Abwartende Strategie" fhir-path="MedicationStatement.where(category.coding.code = 'WS').exists()"/>
  </container>


  <container csv-filename="Surgery-${TIMESTAMP}.csv" excel-sheet="Surgery" >
    <attribute csv-column="Surgery-ID" excel-column="Surgery-ID" fhir-path="Procedure.where(category.coding.code = 'OP').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Procedure.where(category.coding.code = 'OP').reasonReference.reference.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Procedure.where(category.coding.code = 'OP').subject.reference.value" />
    <attribute csv-column="OPS-Code" excel-column="OPS-Code" fhir-path="Procedure.where(category.coding.code = 'OP').code.coding.code.value"/>
    <attribute csv-column="Datum der OP" excel-column="Datum der OP" fhir-path="Procedure.where(category.coding.code = 'OP').performed.value"/>
    <attribute csv-column="Intention OP" excel-column="Intention OP" fhir-path="Procedure.extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-OPIntention').value.coding.code.value"/>
    <attribute csv-column="OP" excel-column="OP" fhir-path="Procedure.where(category.coding.code = 'OP').exists()"/>
  </container>


  <container csv-filename="Radiation-Therapy-${TIMESTAMP}.csv" excel-sheet="Radiation Therapy">
    <attribute csv-column="Radiation-Therapy-ID" excel-column="Radiation-Therapy-ID" fhir-path="Procedure.where(category.coding.code = 'ST').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Procedure.where(category.coding.code = 'ST').reasonReference.reference.value"/>
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Procedure.where(category.coding.code = 'ST').subject.reference.value" />
    <attribute csv-column="Strahlentherapie Stellung zu operativer Therapie" excel-column="Strahlentherapie Stellung zu operativer Therapie" fhir-path="Procedure.extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-StellungZurOp').value.coding.code.value"/>
    <attribute csv-column="Intention Strahlentherapie" excel-column="Intention Strahlentherapie" fhir-path="Procedure.extension('http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Extension-SYSTIntention').value.coding.code.value" />
    <attribute csv-column="Strahlentherapie Beginn" excel-column="Strahlentherapie Beginn" fhir-path="Procedure.where(category.coding.code = 'ST').performed.start.value"/>
    <attribute csv-column="Strahlentherapie Ende" excel-column="Strahlentherapie Ende" fhir-path="Procedure.where(category.coding.code = 'ST').performed.end.value"/>
    <attribute csv-column="Strahlentherapie Ende" excel-column="Strahlentherapie Ende" fhir-path="Procedure.where(category.coding.code = 'ST').exists()"/>
  </container>

  <container csv-filename="Molecular-Marker-${TIMESTAMP}.csv" excel-sheet="Molecular Marker">
    <attribute csv-column="Mol-Marker-ID" excel-column="Mol-Marker-ID" fhir-path="Observation.where(code.coding.code = '69548-6').id"/>
    <attribute csv-column="Diagnosis-ID" excel-column="Diagnosis-ID" fhir-path="Observation.where(code.coding.code = '69548-6').focus.reference.value" />
    <attribute csv-column="Patient-ID" excel-column="Patient-ID" fhir-path="Observation.where(code.coding.code = '69548-6').subject.reference.value" />
    <attribute csv-column="Datum der Datenerhebung" excel-column="Datum der Datenerhebung" fhir-path="Observation.where(code.coding.code = '69548-6').effective.value"/>
    <attribute csv-column="Marker" excel-column="Marker" fhir-path="Observation.where(code.coding.code = '69548-6').component.value.coding.code"/>
    <attribute csv-column="Status des molekularen Markers" excel-column="Status des molekularen Markers" fhir-path="Observation.where(code.coding.code = '69548-6').value.coding.code.value" />
    <attribute csv-column="Zusätzliche Alternative Dokumentation" excel-column="Zusätzliche Alternative Dokumentation" fhir-path="Observation.where(code.coding.code = '69548-6').value.text.value"/>
  </container>


  <fhir-rev-include>Observation:patient</fhir-rev-include>
  <fhir-rev-include>Condition:patient</fhir-rev-include>
  <fhir-rev-include>ClinicalImpression:patient</fhir-rev-include>
  <fhir-rev-include>MedicationStatement:patient</fhir-rev-include>
  <fhir-rev-include>Procedure:patient</fhir-rev-include>
  <!-- <fhir-rev-include>Specimen:patient</fhir-rev-include> -->

</template>
